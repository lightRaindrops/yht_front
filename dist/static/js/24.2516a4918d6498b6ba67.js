webpackJsonp([24],{oZ7n:function(t,e){},v2c8:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={props:{},data:function(){return{photo:{title:"",list:[]},action:this.$appConst.EDITOR_IMG_URL+"?th=120&tw=120&token="+this.$store.state.user.token,ImgList:[],titleErr:!1,titleErrMsg:"",listType:"picture-card",fileNums:0,uploaded:0,percent:0}},computed:{},created:function(){},mounted:function(){},watch:{},methods:{uploadSuccess:function(t,e,s){if("success"==t.state){var i=this.makeKey(),o={url:t.url,thumb:t.thumb,imgkey:i};this.uploaded+=1,this.ImgList.push(o)}},beforeUpload:function(t){if(!this.validatorImg(t))return!1;if(this.uploaded==this.fileNums&&this.uploaded>0?this.percent=0:++this.fileNums,this.fileNums>0)var e=this,s=setInterval(function(){e.percent<95&&e.uploaded<e.fileNums?(e.fileNums<=1&&++e.percent,e.fileNums>1&&(e.uploaded<1&&e.percent<parseInt(100/e.fileNums)?++e.percent:parseInt(e.uploaded/e.fileNums*100)>e.percent&&++e.percent)):e.uploaded==e.fileNums&&(clearInterval(s),e.percent=100)},100)},validatorImg:function(t){var e="image/jpeg"===t.type||"image/png"===t.type,s=t.size/1024/1024<2;return e||this.$message.error("上传图片只能是 JPG 和 PNG 格式!"),s||this.$message.error("上传图片大小不能超过 2MB!"),e&&s},onProgress:function(t,e,s){},makeKey:function(){for(var t="qwertyuiopasdfghjklzxcvbnm0123456789",e="",s=0;s<10;++s){e+=t[parseInt(parseInt(t.length)*Math.random())]}return e},removePic:function(t){var e=this;this.$confirm("是否要删除该图片?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s=e.ImgList.filter(function(e){return e.imgkey!=t.imgkey});e.ImgList=s}).catch(function(){})},submitPhoto:function(){var t=this;if(!this.photo.title)return this.titleErr=!0,this.titleErrMsg="标题不能为空",!1;this.photo.list=this.ImgList,this.$store.dispatch("ForumPhotosAdd",this.photo).then(function(){"success"==t.$store.state.user.ForumPhotosAdd.status?(t.$notify.success("操作成功"),t.photo.title="",t.photo.list=[],t.ImgList=[],t.percent=0):t.$notify.error("上传失败")})},cleanErr:function(){this.titleErr=!1,this.titleErrMsg=""}},components:{}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"photos-wallper"},[s("div",{staticClass:"edit-title"},[s("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.photo.title,expression:"photo.title",modifiers:{trim:!0}}],staticClass:"titleInput",attrs:{placeholder:"请输入标题"},domProps:{value:t.photo.title},on:{focus:t.cleanErr,input:function(e){e.target.composing||t.$set(t.photo,"title",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t.titleErr?s("p",{staticClass:"err-msg"},[t._v(t._s(t.titleErrMsg))]):t._e()]),t._v(" "),s("div",{staticClass:"photo-content"},[s("div",{staticClass:"photo-upload"},[s("el-upload",{staticClass:"upload",attrs:{drag:"",action:t.action,"show-file-list":!1,"on-success":t.uploadSuccess,"before-upload":t.beforeUpload,"on-progress":t.onProgress,multiple:""}},[s("i",{staticClass:"el-icon-upload"}),t._v(" "),s("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处, 或"),s("em",[t._v("点击上传")])]),t._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过2MB")])])],1),t._v(" "),s("div",{staticClass:"progress"},[s("span",[t._v("进度:")]),t._v(" "),s("div",{staticClass:"progress-container"},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percent,status:"success"}})],1)]),t._v(" "),s("div",{staticClass:"photo-container"},[s("div",{staticClass:"img-list"},t._l(t.ImgList,function(e,i){return s("div",{key:i,staticClass:"img-item"},[s("img",{staticClass:"img-animation",attrs:{src:e.thumb,alt:""}}),t._v(" "),s("div",{staticClass:"item-action"},[s("span",{attrs:{title:"删除"},on:{click:function(s){return t.removePic(e)}}},[s("i",{staticClass:"el-icon-delete"})])])])}),0)])]),t._v(" "),s("div",{staticClass:"photo-btn"},[s("el-button",{attrs:{type:"primary",size:"medium"},nativeOn:{click:function(e){return t.submitPhoto(e)}}},[t._v("提交")])],1)])},staticRenderFns:[]};var r=s("VU/8")(i,o,!1,function(t){s("oZ7n")},"data-v-72005c34",null);e.default=r.exports}});