webpackJsonp([40],{"0NE2":function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var e=i("Fd2+"),a={data:function(){return{limit:5,loading:!1,loadAll:!1,pageNow:1,list:[],showPop:!1,comment:"",item:this.$store.state.user.CurrentCustomer}},methods:{returnLast:function(){this.$router.go(-1)},load:function(){this.loading=!0,++this.pageNow,this.initComments(this.item.id)},initComments:function(t){var s=this;0==this.loading&&e.h.loading({message:"加载中...",duration:0}),this.$store.dispatch("getComments",{id:t,offset:this.offset,limit:this.limit}).then(function(){s.loading=!1;var t=s.$store.state.user.comments.data;for(var i in s.loadAll=s.$store.state.user.comments.loadAll,t)s.list.push(t[i]);e.h.clear()})},changePop:function(){this.showPop=!0},submitCommit:function(){var t=this;""==this.comment?e.h.fail("内容不能为空"):this.$store.dispatch("appendComments",{content:this.comment,customer_id:this.item.id}).then(function(){if("success"==t.$store.state.user.append_comments.status){e.h.success({message:"操作成功",duration:2e3});var s=t;setTimeout(function(){s.showPop=!1,t.list=[],t.initComments(t.item.id)},2200)}else e.h.fail("操作失败")})}},created:function(){this.initComments(this.item.id)},computed:{offset:function(){return(this.pageNow-1)*this.limit}},directives:{focus:{inserted:function(t){t.focus()}}}},o={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"wapper"},[i("div",{staticClass:"title"},[i("span",{staticClass:"icon",on:{click:t.returnLast}},[i("i",{staticClass:"iconfont icon-fanhui"})]),t._v(" "),i("p",{staticClass:"text"},[t._v("跟进记录")]),t._v(" "),i("span",{staticClass:"icon",on:{click:t.changePop}},[i("mu-ripple",[i("i",{staticClass:"el-icon-plus"})])],1)]),t._v(" "),i("div",{staticClass:"tab-container"},[i("mu-load-more",{attrs:{loading:t.loading,"loaded-all":t.loadAll},on:{load:t.load}},t._l(t.list,function(s){return i("div",{staticClass:"item"},[i("div",{staticClass:"item-headImg"},[i("img",{attrs:{src:null==s.headimg?"http://e.yhtjc.com/v2/public/img/default.png":s.headimg}})]),t._v(" "),i("div",{staticClass:"item-content"},[i("div",{staticClass:"username"},[t._v(t._s(s.user_name))]),t._v(" "),i("div",{staticClass:"text"},[t._v(t._s(s.content))]),t._v(" "),i("div",{staticClass:"foot"},[t._v(t._s(s.updated))])])])})),t._v(" "),i("p",{directives:[{name:"show",rawName:"v-show",value:t.loadAll,expression:"loadAll"}],style:{"margin-bottom":"20px","text-align":"center"}},[t._v("已加载完毕, 共 "+t._s(t.list.length)+" 条记录")])],1),t._v(" "),i("van-popup",{staticClass:"comments-popup",attrs:{position:"right",overlay:!1},model:{value:t.showPop,callback:function(s){t.showPop=s},expression:"showPop"}},[i("div",{staticClass:"tool"},[i("span",[i("a",{attrs:{href:"javascript:void(0)"},on:{click:function(s){t.showPop=!1}}},[t._v("取消")])]),t._v(" "),i("span",[i("a",{attrs:{href:"javascript:void(0)"},on:{click:t.submitCommit}},[t._v("提交")])])]),t._v(" "),i("div",{staticClass:"input-content"},[i("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.comment,expression:"comment",modifiers:{trim:!0}},{name:"focus",rawName:"v-focus",value:!0,expression:"true"}],ref:"textarea",attrs:{placeholder:"请输入内容"},domProps:{value:t.comment},on:{input:function(s){s.target.composing||(t.comment=s.target.value.trim())},blur:function(s){t.$forceUpdate()}}})])])],1)},staticRenderFns:[]};var n=i("VU/8")(a,o,!1,function(t){i("96Ym")},"data-v-11b1d682",null);s.default=n.exports},"96Ym":function(t,s){}});