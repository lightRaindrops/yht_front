webpackJsonp([39],{G6Fh:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={props:{mobile:{type:Boolean,default:!1}},data:function(){return{loading:!1,limit:10,pageNow:1,list:[],loadAll:!1,showCustomAction:!1,trackLoading:!0,outerVisible:!1,innerVisible:!1,currentItem:"",popShow:!1,menuOpen:!1,trackComment:"",currentClickIndex:0,currentCustomer:[],lastClickIndex:0,isAccept:!1}},methods:{refresh:function(){},load:function(){this.loading=!0,++this.pageNow,this.initList()},initList:function(){var t=this;this.$store.dispatch("getPersonalCustomer",{limit:this.limit,offset:this.offset}).then(function(){t.loading=!1;var e=t.$store.state.user.personal_customer_list.data;for(var i in t.loadAll=t.$store.state.user.personal_customer_list.loadAll,e)t.list.push(e[i])})},openDetail:function(t){this.currentItem=t,this.showCustomAction=!0},track:function(t){this.currentItem=t,this.outerVisible=!0,this.initComments(t.id)},parseTimeStamp:function(t){var e=new Date(1e3*parseInt(t));return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},showMenu:function(t){this.currentClickIndex=t},accept:function(t){var e=this;this.currentClickIndex=0,1==this.mobile?this.$dialog.confirm({message:"验收客户 <"+t.name+">, 该客户将纳入你的名下,确定进行该操作 ?"}).then(function(){e.submitAccept(t)}).catch(function(){}):this.$confirm("验收客户 <"+t.name+">, 该客户将纳入你的名下,确定进行该操作 ?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(function(){e.submitAccept(t)}).catch(function(){})},submitAccept:function(t){var e=this;this.$store.dispatch("acceptCustomer",{id:t.id}).then(function(){"success"==e.$store.state.user.acceptCustomer.status?(e.mobile?Toast.success("操作成功"):e.$notify.success({title:"操作成功",message:"客户<"+t.name+"> 已验收"}),e.list=[],e.initList()):e.mobile?Toast.error("操作失败"):e.$notify.error({title:"操作失败",message:e.$store.state.user.acceptCustomer.error})})},free:function(t){var e=this;this.currentClickIndex=0,this.mobile?this.$dialog.confirm({message:"释放客户 <"+t.name+">后，其他同事可以再次跟进此客户, 确定进行该操作 ?"}).then(function(){e.submitFree(t)}).catch(function(){}):this.$confirm("释放客户 <"+t.name+">后，其他同事可以再次跟进此客户, 确定进行该操作 ?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.submitFree(t)}).catch(function(){})},submitFree:function(t){var e=this;this.$store.dispatch("freeCustomer",{id:t.id}).then(function(){"success"==e.$store.state.user.freeCustomer.status?(e.mobile?Toast.success("操作成功"):e.$notify.success({title:"操作成功",message:"客户<"+t.name+">已经释放"}),e.list=[],e.initList()):e.mobile?Toast.error("操作失败"):e.$notify.error({title:"操作失败",mesage:e.$store.state.user.freeCustomer.error})})},initComments:function(t){var e=this;this.trackLoading=!0,this.$store.dispatch("getComments",{id:t,offset:0,limit:15}).then(function(){e.trackLoading=!1})},submitFllowForm:function(){var t=this;if(""==this.trackComment)return!1;this.$store.dispatch("appendComments",{content:this.trackComment,customer_id:this.currentItem.id}).then(function(){"success"==t.$store.state.user.append_comments.status?(t.$notify.success({title:"操作成功",message:"记录已添加"}),t.trackComment="",t.initComments(t.currentItem.id)):t.$notify.error({title:"操作失败",message:t.$store.state.user.append_comments.error})})}},created:function(){this.initList()},computed:{offset:function(){return(this.pageNow-1)*this.limit},comments:function(){return this.$store.state.user.comments.data},ReceiveNum:function(){return this.$store.state.user.personal_customer_list.count},AcceptNum:function(){return this.$store.state.user.personal_customer_list.accept}}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"wapper"},[i("mu-container",{ref:"container",staticClass:"loadmore-content"},[i("mu-list",{attrs:{textline:"three-line"}},[i("mu-sub-header",[i("div",{staticClass:"customer-mu-sub-header"},[i("p",[t._v("已领取客户: "),i("span",{staticStyle:{color:"#f44336"}},[t._v(t._s(t.ReceiveNum))]),t._v(" 个")]),t._v(" "),i("p",[t._v("已验收客户: "),i("span",{staticStyle:{color:"#f44336"}},[t._v(t._s(t.AcceptNum))]),t._v(" 个")]),t._v(" "),i("p",{staticStyle:{"font-size":"12px"}},[t._v("带星号表示已验收")])])]),t._v(" "),t._l(t.list,function(e){return[i("mu-list-item",[i("mu-list-item-content",[i("mu-list-item-title",[t._v("\n\t\t\t        \t"+t._s(e.name)+"\n\t\t\t        \t"),i("span",{directives:[{name:"show",rawName:"v-show",value:1==e.accept,expression:"item.accept == 1"}]},[i("mu-icon",{attrs:{value:"grade",color:"success",size:"18"}})],1)]),t._v(" "),i("mu-list-item-sub-title",[i("span",{staticStyle:{color:"rgba(0, 0, 0, .87)"}},[t._v(t._s(e.province)+" "+t._s(e.city)+" "+t._s(e.area))]),i("br"),t._v(" "),i("span",[t._v(t._s(t.parseTimeStamp(e.created_at)))]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.mobile,expression:"mobile ? false : true"}]},[t._v("需求："+t._s(e.demand)+"  ")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.mobile,expression:"mobile ? false : true"}]},[t._v("备注: "+t._s(e.description))])])],1),t._v(" "),i("mu-list-item-action",{style:{position:"relative",overflow:"hidden"}},[i("mu-button",{attrs:{small:"","full-width":"",color:"primary"},on:{click:function(i){return t.openDetail(e)}}},[t._v("\n\t\t\t\t    \t详情\n\t\t\t\t    ")]),t._v(" "),i("mu-button",{directives:[{name:"show",rawName:"v-show",value:1==e.accept,expression:"item.accept == 1"}],attrs:{small:"","full-width":"",color:"success"},on:{click:function(i){return t.track(e)}}},[t._v("\n\t\t\t\t    \t跟进\n\t\t\t\t    ")]),t._v(" "),i("mu-menu",{directives:[{name:"show",rawName:"v-show",value:0==e.accept,expression:"item.accept == 0"}],attrs:{cover:"",open:t.currentClickIndex==e.id}},[i("mu-button",{staticStyle:{width:"95px","padding-left":"5px"},attrs:{color:"orange",small:"","full-width":""},on:{click:function(i){return t.showMenu(e.id)}}},[t._v("操作")]),t._v(" "),i("mu-list",{attrs:{slot:"content"},slot:"content"},[i("mu-list-item",{attrs:{button:""},on:{click:function(i){return t.track(e)}}},[i("mu-list-item-title",{attrs:{color:"orange"}},[t._v("跟进")])],1),t._v(" "),i("mu-list-item",{directives:[{name:"show",rawName:"v-show",value:0==e.accept,expression:"item.accept == 0"}],attrs:{button:""},on:{click:function(i){return t.accept(e)}}},[i("mu-list-item-title",[t._v("验收客户")])],1),t._v(" "),i("mu-list-item",{directives:[{name:"show",rawName:"v-show",value:0==e.accept,expression:"item.accept == 0"}],attrs:{button:""},on:{click:function(i){return t.free(e)}}},[i("mu-list-item-title",[t._v("释放客户")])],1)],1)],1)],1)],1),t._v(" "),i("mu-divider")]})],2)],1),t._v(" "),i("el-dialog",{staticClass:"customer-dialog",attrs:{title:"客户信息",visible:t.showCustomAction,width:"30%",center:""},on:{"update:visible":function(e){t.showCustomAction=e}}},[i("mu-list",{staticClass:"customer-list"},[i("mu-list-item",[i("mu-list-item-title",[t._v("称呼")]),t._v(" "),i("mu-list-item-action",[t._v("\n          \t\t\t"+t._s(t.currentItem.name)+"\n        \t\t")])],1),t._v(" "),i("mu-list-item",[i("mu-list-item-content",[i("mu-list-item-title",[t._v("联系方式")])],1),t._v(" "),i("mu-list-item-action",[i("a",{attrs:{href:"tel:"+t.currentItem.phone}},[t._v(t._s(t.currentItem.phone))])])],1),t._v(" "),i("mu-list-item",[i("mu-list-item-content",[i("mu-list-item-title",[t._v("创建时间")])],1),t._v(" "),i("mu-list-item-action",[t._v("\n\t          \t\t"+t._s(t.parseTimeStamp(t.currentItem.created_at))+"\n\t        \t")])],1),t._v(" "),i("mu-list-item",[i("mu-list-item-title",[t._v("微信号")]),t._v(" "),i("mu-list-item-action",[i("a",{attrs:{href:"javascript:void(0)"}},[t._v(t._s(t.currentItem.wechat))])])],1),t._v(" "),i("mu-list-item",[i("mu-list-item-title",[t._v("QQ号")]),t._v(" "),i("mu-list-item-action",[i("a",{attrs:{href:"javascript:void(0)"}},[t._v(t._s(t.currentItem.qq))])])],1),t._v(" "),i("mu-list-item",[i("mu-list-item-title",[t._v("咨询品牌")]),t._v(" "),i("mu-list-item-action",[t._v("\n          \t\t\t"+t._s(t.currentItem.brand_name)+"\n        \t\t")])],1),t._v(" "),i("mu-list-item",[i("mu-list-item-title",{style:{flex:1}},[t._v("所属地区")]),t._v(" "),i("mu-list-item-action",{style:{flex:2}},[t._v("\n          \t\t\t"+t._s(t.currentItem.province)+" "+t._s(t.currentItem.city)+" "+t._s(t.currentItem.area)+"\n        \t\t")])],1),t._v(" "),i("mu-list-item",[i("mu-list-item-title",[t._v("项目名称")]),t._v(" "),i("mu-list-item-action",[t._v("\n          \t\t\t"+t._s(t.currentItem.project_name)+"\n        \t\t")])],1),t._v(" "),i("mu-list-item",{style:{"margin-top":"20px"}},[i("mu-list-item-title",[t._v("产品需求")]),t._v(" "),i("mu-list-item-action",[t._v("\n          \t\t\t"+t._s(t.currentItem.demand)+"\n        \t\t")])],1),t._v(" "),i("mu-list-item",{style:{"margin-top":"20px"}},[i("mu-list-item-title",[t._v("备注信息")]),t._v(" "),i("mu-list-item-action",[t._v("\n          \t\t\t"+t._s(t.currentItem.description)+"\n        \t\t")])],1)],1)],1),t._v(" "),i("el-dialog",{staticClass:"comment-dialog",attrs:{title:"客户跟进记录",visible:t.outerVisible},on:{"update:visible":function(e){t.outerVisible=e}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.trackLoading,expression:"trackLoading"}],staticClass:"track-container"},t._l(t.comments,function(e){return i("div",{staticClass:"item"},[i("div",{staticClass:"headimg"},[i("img",{attrs:{src:null==e.headimg?"http://e.yhtjc.com/v2/public/img/default.png":e.headimg}})]),t._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"user-name"},[t._v(t._s(e.user_name)+" "),i("span",[t._v("发表于 "+t._s(e.updated))])]),t._v(" "),i("div",{staticClass:"text"},[t._v(t._s(e.content))])])])}),0),t._v(" "),i("el-dialog",{attrs:{width:"30%",title:"客户回访",visible:t.innerVisible,"append-to-body":""},on:{"update:visible":function(e){t.innerVisible=e}}},[i("div",{staticClass:"newTrack",staticStyle:{"text-align":"center"}},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:30},placeholder:"请输入内容"},model:{value:t.trackComment,callback:function(e){t.trackComment="string"==typeof e?e.trim():e},expression:"trackComment"}}),t._v(" "),i("el-button",{staticStyle:{"margin-top":"15px","margin-bottom":": -5px"},attrs:{type:"primary"},on:{click:t.submitFllowForm}},[t._v("提交")])],1)]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.outerVisible=!1}}},[t._v("关 闭")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.innerVisible=!0}}},[t._v("新增记录")])],1)],1)],1)},staticRenderFns:[]};var o=i("VU/8")(s,n,!1,function(t){i("uhnx")},"data-v-1b006d88",null);e.default=o.exports},uhnx:function(t,e){}});